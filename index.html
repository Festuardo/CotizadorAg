<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Cooperativa Tonantel, R.L.</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.0;
            margin: 0;
            padding: 10px;
            color: #444;
            font-size: 14px;
            background-color: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            background-color: #ffffff;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .logo {
            max-width: 180px;
            margin-right: 20px;
        }
        .title {
            flex-grow: 1;
        }
        h1 {
            font-size: 22px;
            margin: 5px 0;
            color: #2c3e50;
        }
        h2 {
            font-size: 17px;
            margin: 5px 0;
            color: #4a6b8a;
            font-weight: normal;
        }
        h3 {
            font-size: 16px;
            margin: 10px 0 5px 0;
            color: #3a5673;
        }
        .form-group {
            margin-bottom: 12px;
        }
        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 13px;
            color: #4a6b8a;
        }
        input, select, textarea {
            width: 100%;
            padding: 7px;
            border: 1px solid #d1dbe5;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: #f8fafc;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #a0b9d0;
            outline: none;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -8px;
        }
        .col {
            flex: 1;
            padding: 0 8px;
            min-width: 200px;
        }
        .btn {
            background-color: #5a8dee;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #3a6fd6;
        }
        .btn-secondary {
            background-color: #f27474;
        }
        .btn-secondary:hover {
            background-color: #e05252;
        }
        .requirements {
            background-color: #f0f5ff;
            padding: 10px;
            border-radius: 6px;
            margin: 12px 0;
            display: none;
            font-size: 13px;
            border-left: 4px solid #a0b9d0;
        }
        .requirements ul {
            margin: 4px 0;
            padding-left: 18px;
        }
        .requirements li {
            margin-bottom: 3px;
            color: #4a6b8a;
        }
        .advisor-info {
            background-color: #f0f7ff;
            padding: 10px;
            border-radius: 6px;
            margin: 12px 0;
            font-size: 14px;
            border-left: 4px solid #a0c4e0;
        }
        table {
            width: auto;
            margin: 15px auto;
            border-collapse: collapse;
            display: none;
            font-size: 13px;
            box-shadow: 0 0 8px rgba(0,0,0,0.03);
        }
        th, td {
            border: 1px solid #e0e6ed;
            padding: 6px 10px;
            text-align: center;
            position: relative;
        }
        th, td {
            border-left: 1px solid #e0e6ed;
            border-right: 1px solid #e0e6ed;
        }
        tr:first-child th {
            border-top: 1px solid #e0e6ed;
        }
        tr:last-child td {
            border-bottom: 1px solid #e0e6ed;
        }
        th {
            background-color: #f0f5ff;
            font-weight: 600;
            color: #3a5673;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .payment {
            font-weight: bold;
            color: #3a6fd6;
        }
        .total-row {
            font-weight: bold;
            background-color: #e1f0ff !important;
            color: #2a5cb5;
        }
        .print-only {
            display: none;
        }
        .print-header {
            text-align: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e6ed;
        }
        .print-header img {
            max-width: 180px;
            float: left;
            margin-right: 12px;
            margin-bottom: 8px;
        }
        .print-details {
            margin-bottom: 12px;
            font-size: 13px;
            line-height: 1.4;
        }
        .print-details p {
            margin: 4px 0;
            display: flex;
        }
        .print-details strong {
            min-width: 120px;
            display: inline-block;
            color: #3a5673;
        }
        .print-requirements {
            margin: 12px 0;
            page-break-inside: avoid;
            font-size: 12px;
            line-height: 1.4;
        }
        .print-requirements h3 {
            margin: 8px 0 4px 0;
            font-size: 13px;
            border-bottom: 1px solid #e0e6ed;
            padding-bottom: 3px;
            color: #3a5673;
        }
        .print-requirements ul {
            margin: 4px 0;
            padding-left: 16px;
        }
        @media print {
            @page {
                size: 8.5in 13in;
                margin: 10mm 15mm;
            }
            .no-print {
                display: none;
            }
            .print-only {
                display: block;
            }
            body {
                padding: 8px;
                font-size: 12px;
                line-height: 1.3;
                background-color: white;
                width: 100%;
            }
            .container {
                box-shadow: none;
                padding: 8px;
                width: 100%;
                max-width: 100%;
            }
            table {
                font-size: 11px;
                width: 100% !important;
                margin: 12px auto;
            }
            th, td {
                padding: 5px 7px;
            }
            .print-header {
                margin-bottom: 8px;
            }
            .print-header h1 {
                font-size: 18px;
                margin: 4px 0;
            }
            .print-header h2 {
                font-size: 14px;
                margin: 4px 0;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            .col {
                flex: 100%;
                padding: 0;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .logo {
                margin: 0 0 12px 0;
            }
            table {
                width: 100%;
                font-size: 12px;
            }
        }
        .custom-advisor {
            display: none;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header no-print">
            <img src="images/logo.png" class="logo">
            <div class="title">
                <h1>Cooperativa Tonantel, R.L.</h1>
                <h2>Cotizador de Préstamos</h2>
            </div>
        </div>

        <div class="print-only print-header">
            <img src="images/logo.png" alt="Logo Cooperativa Tonantel" class="logo">
            <div class="print-header-text">
                <h1>Cooperativa Tonantel, R.L.</h1>
                <h2>Cotización de Préstamo</h2>
            </div>
        </div>

        <div class="print-only print-details">
            <p><strong>Fecha:</strong> <span id="print-date"></span></p>
            <p><strong>Nombre:</strong> <span id="print-name"></span></p>
            <p><strong>Monto:</strong> <span id="print-amount"></span></p>
            <p><strong>Plazo:</strong> <span id="print-term"></span> meses</p>
            <p><strong>Tasa de interés:</strong> <span id="print-rate"></span>% anual</p>
            <p><strong>Tipo de cuota:</strong> <span id="print-payment-type"></span></p>
            <p><strong>Sector:</strong> <span id="print-sector"></span></p>
            <p><strong>Asesor:</strong> <span id="print-advisor"></span></p>
        </div>

        <div id="print-requirements-gobernacion" class="print-only print-requirements" style="display: none;">
            <h3>Requisitos para Ministerio de Gobernación:</h3>
            <ul>
                <li>Apertura de cuenta Q. 100.00</li>
                <li>DPI</li>
                <li>Estados de cuenta de los últimos 3 meses</li>
                <li>Constancia Laboral</li>
                <li>Constancia Salarial</li>
                <li>Record de Servicio</li>
                <li>Régimen Disciplinario</li>
            </ul>
        </div>

        <div id="print-requirements-educacion" class="print-only print-requirements" style="display: none;">
            <h3>Requisitos para Ministerio de Educación:</h3>
            <ul>
                <li>Apertura de cuenta Q. 100.00</li>
                <li>DPI</li>
                <li>Estados de cuenta de los últimos 3 meses</li>
                <li>Constancia Laboral</li>
                <li>Boucher de Pago</li>
            </ul>
        </div>

        <div id="print-requirements-privado" class="print-only print-requirements" style="display: none;">
            <h3>Requisitos para Empleado Privado:</h3>
            <ul>
                <li>Apertura de cuenta Q. 100.00</li>
                <li>DPI</li>
                <li>Estados de cuenta de los últimos 3 meses</li>
                <li>Constancia Laboral</li>
                <li>Boucher de Pago</li>
                <li><strong>Presentar Fiador*</strong></li>
            </ul>
            <p style="font-size: 11px; margin-top: 3px; font-style: italic;">* El fiador debe presentar los mismos requisitos</p>
        </div>

        <div id="print-requirements-comerciante" class="print-only print-requirements" style="display: none;">
            <h3>Requisitos para Comerciante:</h3>
            <ul>
                <li>Apertura de cuenta Q. 100.00</li>
                <li>DPI</li>
                <li>Estados de cuenta de los últimos 6 meses</li>
                <li>Constancia de Ingresos</li>
                <li>RTU o Patente de Comercio</li>
                <li><strong>Presentar Fiador*</strong></li>
            </ul>
            <p style="font-size: 11px; margin-top: 3px; font-style: italic;">* El fiador debe presentar los mismos requisitos</p>
        </div>

        <div id="print-additional-requirements" class="print-only print-requirements" style="display: none;">
            <h3>Requisitos adicionales:</h3>
            <div id="print-additional-requirements-content"></div>
        </div>

        <div class="no-print">
            <form id="loan-form">
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="name">Nombre del asociado (opcional):</label>
                            <input type="text" id="name" name="name">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="amount">Monto del préstamo (Q):</label>
                            <input type="number" id="amount" name="amount" required min="1" step="0.01" inputmode="decimal">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="term">Plazo (meses):</label>
                            <input type="number" id="term" name="term" required min="1" inputmode="numeric">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="rate">Tasa de interés anual (%):</label>
                            <input type="number" id="rate" name="rate" step="0.01" required min="0.01" max="100" inputmode="decimal">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="payment-type">Tipo de cuota:</label>
                            <select id="payment-type" name="payment-type" required>
                                <option value="level">Nivelada</option>
                                <option value="decreasing">Decreciente</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="sector">Sector del asociado (opcional):</label>
                            <select id="sector" name="sector">
                                <option value="">Seleccione (opcional)...</option>
                                <option value="gobernacion">Ministerio de Gobernación</option>
                                <option value="educacion">Ministerio de Educación</option>
                                <option value="privado">Empleado Privado</option>
                                <option value="comerciante">Comerciante</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="requirements-gobernacion" class="requirements">
                    <h3>Requisitos para Ministerio de Gobernación:</h3>
                    <ul>
                        <li>Apertura de cuenta Q. 100.00</li>
                        <li>DPI</li>
                        <li>Estados de cuenta de los últimos 3 meses</li>
                        <li>Constancia Laboral</li>
                        <li>Constancia Salarial</li>
                        <li>Record de Servicio</li>
                        <li>Régimen Disciplinario</li>
                    </ul>
                </div>

                <div id="requirements-educacion" class="requirements">
                    <h3>Requisitos para Ministerio de Educación:</h3>
                    <ul>
                        <li>Apertura de cuenta Q. 100.00</li>
                        <li>DPI</li>
                        <li>Estados de cuenta de los últimos 3 meses</li>
                        <li>Constancia Laboral</li>
                        <li>Boucher de Pago</li>
                    </ul>
                </div>

                <div id="requirements-privado" class="requirements" style="display: none;">
                    <h3>Requisitos para Empleado Privado:</h3>
                    <ul>
                        <li>Apertura de cuenta Q. 100.00</li>
                        <li>DPI</li>
                        <li>Estados de cuenta de los últimos 3 meses</li>
                        <li>Constancia Laboral</li>
                        <li>Boucher de Pago</li>
                        <li><strong>Presentar Fiador*</strong></li>
                    </ul>
                    <p style="font-size: 12px; margin-top: 5px; font-style: italic;">* El fiador debe presentar los mismos requisitos</p>
                </div>

                <div id="requirements-comerciante" class="requirements" style="display: none;">
                    <h3>Requisitos para Comerciante:</h3>
                    <ul>
                        <li>Apertura de cuenta Q. 100.00</li>
                        <li>DPI</li>
                        <li>Estados de cuenta de los últimos 6 meses</li>
                        <li>Constancia de Ingresos</li>
                        <li>RTU o Patente de Comercio</li>
                        <li><strong>Presentar Fiador*</strong></li>
                    </ul>
                    <p style="font-size: 12px; margin-top: 5px; font-style: italic;">* El fiador debe presentar los mismos requisitos</p>
                </div>

                <div class="form-group">
                    <label for="additional-requirements">Requisitos Adicionales (opcional):</label>
                    <textarea id="additional-requirements" name="additional-requirements" rows="3"></textarea>
                </div>

                <div class="advisor-info">
                    <h3>Asesor:</h3>
                    <select id="advisor" name="advisor">
                        <option value="">Seleccione...</option>
                        <option value="franklin">Franklin García - Tel: 3018 0896</option>
                        <option value="luis">Luis Morfín - Tel: 3018 0592</option>
                        <option value="dawin">Dawin Lemus - Tel: 5755 1414</option>
                        <option value="ivan">Iván Lucero - Tel: 3018 0113</option>
                        <option value="otro">Agregar Asesor</option>
                    </select>
                    <div id="custom-advisor" class="custom-advisor">
                        <div class="form-group">
                            <label for="advisor-name">Nombre del Asesor:</label>
                            <input type="text" id="advisor-name" name="advisor-name">
                        </div>
                        <div class="form-group">
                            <label for="advisor-phone">Teléfono del Asesor:</label>
                            <input type="text" id="advisor-phone" name="advisor-phone">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" id="generate-btn" class="btn">Generar Cotización</button>
                    <button type="button" id="print-btn" class="btn" disabled>Imprimir</button>
                    <button type="reset" id="clear-btn" class="btn btn-secondary">Limpiar</button>
                </div>
            </form>
        </div>

        <div id="amortization-container">
            <h3 class="no-print">Tabla de Amortización</h3>
            <table id="amortization-table">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Cuota</th>
                        <th>Interés</th>
                        <th>Capital</th>
                        <th>Saldo</th>
                    </tr>
                </thead>
                <tbody id="amortization-body">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Formatear números como moneda GTQ
            function formatCurrency(amount) {
                return 'Q ' + parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            // Mostrar requisitos según sector
            const sectorSelect = document.getElementById('sector');
            const gobernacionReq = document.getElementById('requirements-gobernacion');
            const educacionReq = document.getElementById('requirements-educacion');
            const privadoReq = document.getElementById('requirements-privado');
            const comercianteReq = document.getElementById('requirements-comerciante');
            const printGobernacionReq = document.getElementById('print-requirements-gobernacion');
            const printEducacionReq = document.getElementById('print-requirements-educacion');
            const printPrivadoReq = document.getElementById('print-requirements-privado');
            const printComercianteReq = document.getElementById('print-requirements-comerciante');
            const printAdditionalReq = document.getElementById('print-additional-requirements');

            sectorSelect.addEventListener('change', function() {
                // Ocultar todos los requisitos primero
                gobernacionReq.style.display = 'none';
                educacionReq.style.display = 'none';
                privadoReq.style.display = 'none';
                comercianteReq.style.display = 'none';
                
                // Mostrar solo los requisitos correspondientes
                if (this.value === 'gobernacion') {
                    gobernacionReq.style.display = 'block';
                } else if (this.value === 'educacion') {
                    educacionReq.style.display = 'block';
                } else if (this.value === 'privado') {
                    privadoReq.style.display = 'block';
                } else if (this.value === 'comerciante') {
                    comercianteReq.style.display = 'block';
                }
            });

            // Control para mostrar/ocultar campos de asesor personalizado
            const advisorSelect = document.getElementById('advisor');
            const customAdvisorDiv = document.getElementById('custom-advisor');
            
            advisorSelect.addEventListener('change', function() {
                if (this.value === 'otro') {
                    customAdvisorDiv.style.display = 'block';
                } else {
                    customAdvisorDiv.style.display = 'none';
                }
            });

            // Generar tabla de amortización
            document.getElementById('generate-btn').addEventListener('click', generateAmortization);
            document.getElementById('print-btn').addEventListener('click', printQuote);
            document.getElementById('clear-btn').addEventListener('click', clearForm);

            function generateAmortization() {
                // Validar solo los campos obligatorios
                const amount = document.getElementById('amount');
                const term = document.getElementById('term');
                const rate = document.getElementById('rate');
                
                if (!amount.checkValidity() || !term.checkValidity() || !rate.checkValidity()) {
                    amount.reportValidity();
                    term.reportValidity();
                    rate.reportValidity();
                    return;
                }

                // Obtener valores del formulario
                const name = document.getElementById('name').value;
                const amountVal = parseFloat(amount.value);
                const termVal = parseInt(term.value);
                const annualRate = parseFloat(rate.value);
                const paymentType = document.getElementById('payment-type').value;
                const paymentTypeText = document.getElementById('payment-type').options[document.getElementById('payment-type').selectedIndex].text;
                const sector = document.getElementById('sector').value;
                const sectorText = sector ? document.getElementById('sector').options[document.getElementById('sector').selectedIndex].text : 'No especificado';
                const monthlyRate = annualRate / 100 / 12;
                const additionalRequirements = document.getElementById('additional-requirements').value;
                
                // Obtener información del asesor
                let advisorText = 'No especificado';
                const advisorValue = advisorSelect.value;
                
                if (advisorValue === 'otro') {
                    const advisorName = document.getElementById('advisor-name').value;
                    const advisorPhone = document.getElementById('advisor-phone').value;
                    if (advisorName || advisorPhone) {
                        advisorText = advisorName + (advisorPhone ? ' - Tel: ' + advisorPhone : '');
                    }
                } else if (advisorValue) {
                    advisorText = advisorSelect.options[advisorSelect.selectedIndex].text;
                }

                // Control de requisitos para impresión
                printGobernacionReq.style.display = 'none';
                printEducacionReq.style.display = 'none';
                printPrivadoReq.style.display = 'none';
                printComercianteReq.style.display = 'none';
                printAdditionalReq.style.display = 'none';

                if (sector === 'gobernacion') {
                    printGobernacionReq.style.display = 'block';
                } else if (sector === 'educacion') {
                    printEducacionReq.style.display = 'block';
                } else if (sector === 'privado') {
                    printPrivadoReq.style.display = 'block';
                } else if (sector === 'comerciante') {
                    printComercianteReq.style.display = 'block';
                }

                if (additionalRequirements.trim() !== '') {
                    document.getElementById('print-additional-requirements-content').innerHTML = '<p>' + additionalRequirements.replace(/\n/g, '<br>') + '</p>';
                    printAdditionalReq.style.display = 'block';
                }

                // Calcular amortización según tipo de cuota
                const tableBody = document.getElementById('amortization-body');
                tableBody.innerHTML = '';
                
                let balance = amountVal;
                let totalInterest = 0;
                let totalPayment = 0;
                let payment;

                if (paymentType === 'level') {
                    // Cuota nivelada
                    payment = amountVal * (monthlyRate * Math.pow(1 + monthlyRate, termVal)) / (Math.pow(1 + monthlyRate, termVal) - 1);
                    
                    for (let i = 1; i <= termVal; i++) {
                        const interest = balance * monthlyRate;
                        const principal = payment - interest;
                        balance -= principal;
                        
                        totalInterest += interest;
                        totalPayment += payment;
                        
                        // Ajustar el último pago por posibles errores de redondeo
                        if (i === termVal) {
                            balance = 0;
                        }
                        
                        addRow(i, payment, interest, principal, balance);
                    }
                } else {
                    // Cuota decreciente
                    const principalPayment = amountVal / termVal;
                    
                    for (let i = 1; i <= termVal; i++) {
                        const interest = balance * monthlyRate;
                        payment = principalPayment + interest;
                        balance -= principalPayment;
                        
                        totalInterest += interest;
                        totalPayment += payment;
                        
                        // Ajustar el último pago por posibles errores de redondeo
                        if (i === termVal) {
                            balance = 0;
                        }
                        
                        addRow(i, payment, interest, principalPayment, balance);
                    }
                }

                // Agregar fila de totales
                const totalRow = document.createElement('tr');
                totalRow.className = 'total-row';
                totalRow.innerHTML = `
                    <td colspan="2"><strong>Total a Pagar: ${formatCurrency(amountVal + totalInterest)}</strong></td>
                    <td><strong>${formatCurrency(totalInterest)}</strong></td>
                    <td><strong>${formatCurrency(amountVal)}</strong></td>
                    <td></td>
                `;
                tableBody.appendChild(totalRow);

                // Mostrar tabla
                document.getElementById('amortization-table').style.display = 'table';
                document.getElementById('print-btn').disabled = false;

                // Preparar datos para impresión
                document.getElementById('print-name').textContent = name || 'No especificado';
                document.getElementById('print-amount').textContent = formatCurrency(amountVal);
                document.getElementById('print-term').textContent = termVal;
                document.getElementById('print-rate').textContent = annualRate;
                document.getElementById('print-payment-type').textContent = paymentTypeText;
                document.getElementById('print-sector').textContent = sectorText;
                document.getElementById('print-advisor').textContent = advisorText;
                
                const today = new Date();
                document.getElementById('print-date').textContent = today.toLocaleDateString('es-GT', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            function addRow(period, payment, interest, principal, balance) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${period}</td>
                    <td class="payment">${formatCurrency(payment)}</td>
                    <td>${formatCurrency(interest)}</td>
                    <td>${formatCurrency(principal)}</td>
                    <td>${formatCurrency(balance)}</td>
                `;
                document.getElementById('amortization-body').appendChild(row);
            }

            function printQuote() {
                window.print();
            }

            function clearForm() {
                document.getElementById('amortization-table').style.display = 'none';
                document.getElementById('print-btn').disabled = true;
                gobernacionReq.style.display = 'none';
                educacionReq.style.display = 'none';
                privadoReq.style.display = 'none';
                comercianteReq.style.display = 'none';
                printGobernacionReq.style.display = 'none';
                printEducacionReq.style.display = 'none';
                printPrivadoReq.style.display = 'none';
                printComercianteReq.style.display = 'none';
                printAdditionalReq.style.display = 'none';
                customAdvisorDiv.style.display = 'none';
            }
        });
    </script>
</body>
</html>
